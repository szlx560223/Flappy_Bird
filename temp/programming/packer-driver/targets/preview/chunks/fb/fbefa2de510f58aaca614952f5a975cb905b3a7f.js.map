{"version":3,"sources":["file:///E:/04Project/Cocos/FlappyBird/assets/script/SettingManager.ts"],"names":["_decorator","Component","Node","sys","find","Slider","Label","Setting","ccclass","property","EnumSettingType","EnumNodeType","SettingManager","localSetting","isSaved","nodeArray","stringOfSetting","Array","sliderData","clickApplyBtn","localStorage","setItem","JSON","stringify","clickSettingBtn","event","CustomEventData","getData","Menu","active","i","length","slider","getComponent","progress","lb_value","string","clickReturnBtn","Warning","getItem","parse","getNodeArray","rootNodeChildren","children","changeSetting","parseInt","value","toFixed","birdPos","birdScale","birdGravity","birdSpeedUpDamping","birdSpeedDownDamping","birdJumpStrength","brickSpawnTime","brickSpawnRand","brickSpeed","brickHeight","brickWidth","brickPoint"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, sys, find, Slider, Label } from 'cc';\nimport { Setting } from './Setting';\nconst { ccclass, property } = _decorator;\n\nenum EnumSettingType{//枚举设置类型，便于后续数组操作\n    birdPos=0,\n    birdScale=1,\n    birdGravity=2,\n    birdSpeedUpDamping=3,\n    birdSpeedDownDamping=4,\n    birdJumpStrength=5,\n    brickSpawnTime=6,\n    brickSpawnRand=7,\n    brickSpeed=8,\n    brickHeight=9,\n    brickWidth=10,\n    brickPoint=11,\n}\nenum EnumNodeType{//枚举节点类型，便于后续数组操作\n    lb_description=0,\n    slider=1,\n    lb_value=2\n}\n\n@ccclass('SettingManager')\nexport class SettingManager extends Component {\n    //菜单节点\n    @property(Node)\n    Menu:Node = null!\n    //未保存提示的节点\n    @property(Node)\n    Warning:Node = null!\n    //设置模板，带默认参数\n    private localSetting = new Setting();\n    //保存指示器\n    private isSaved = true;\n    //菜单里的设置的根节点，用于后续查找\n    private nodeArray:Node[][];\n    //设置选项的字符串表，用于查找顺序\n    private  stringOfSetting = new Array(\"birdPos\",\"birdScale\",\"birdGravity\",\"birdSpeedUpDamping\",\"birdSpeedDownDamping\",\"birdJumpStrength\",\"brickSpawnTime\",\"brickSpawnRand\",\"brickSpeed\",\"brickHeight\",\"brickWidth\",\"brickPoint\")\n    //滑条百分比的数据\n    private sliderData = new Setting(0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0)\n\n    clickApplyBtn(){//点击应用按钮\n        sys.localStorage.setItem(\"gameValue\",JSON.stringify(this.localSetting));//储存本地设置至浏览器缓存\n        sys.localStorage.setItem(\"sliderValue\",JSON.stringify(this.sliderData));\n        this.isSaved = true;\n    }\n    clickSettingBtn(event:Event,CustomEventData){//点击设置按钮\n        this.getData();\n        this.Menu.active = true;\n        for(let i=0;i<this.nodeArray.length;i++){\n            this.nodeArray[i][EnumNodeType.slider].getComponent(Slider).progress = this.sliderData[this.stringOfSetting[i]];\n            this.nodeArray[i][EnumNodeType.lb_value].getComponent(Label).string = `${this.localSetting[this.stringOfSetting[i]]}`\n        }\n    }\n    clickReturnBtn(event:Event,CustomEventData){//点击返回按钮\n        if(this.isSaved){\n            this.Menu.active = false;\n            this.Warning.active = false;\n        }\n        else{\n            this.isSaved = true;\n            this.Warning.active = true;\n        }     \n    }\n    getData(){//从浏览器获取缓存数据\n        if(sys.localStorage.getItem(\"gameValue\") === null||sys.localStorage.getItem(\"sliderValue\") === null){//传入默认设置\n            sys.localStorage.setItem(\"gameValue\",JSON.stringify(this.localSetting))\n            sys.localStorage.setItem(\"sliderValue\",JSON.stringify(this.sliderData));\n        }\n        this.localSetting = JSON.parse(sys.localStorage.getItem(\"gameValue\"))//获取浏览器缓存设置\n        this.sliderData = JSON.parse(sys.localStorage.getItem(\"sliderValue\"))\n    }\n    getNodeArray(){//获取设置的所有节点，便于后续操作\n        let rootNodeChildren = find('Canvas/Setting/Sliders').children;\n        this.nodeArray = new Array(rootNodeChildren.length);\n        for(let i=0;i<rootNodeChildren.length;i++){\n            this.nodeArray[i] = new Array(rootNodeChildren[0].children.length)\n            this.nodeArray[i] = rootNodeChildren[i].children;\n        }\n    }\n    changeSetting(event:Event,CustomEventData){ \n        this.isSaved = false;//保存指示器置否，表示未保存状态\n        this.Warning.active = false;//关闭提示标签\n        CustomEventData = parseInt(CustomEventData);//传入是字符串，转成整数\n        let value,progress;\n        progress = this.nodeArray[CustomEventData][EnumNodeType.slider].getComponent(Slider).progress.toFixed(2);//滑动器的百分比\n        \n        switch(CustomEventData){\n            case EnumSettingType.birdPos:\n                value = (1920*progress).toFixed(0);\n                break;\n            case EnumSettingType.birdScale:\n                value = (10+80*progress).toFixed(1);\n                break;\n            case EnumSettingType.birdGravity:\n                value = (4000*progress).toFixed(0);\n                break;\n            case EnumSettingType.birdSpeedUpDamping:\n                value = (0.8*progress).toFixed(2);\n                break;\n            case EnumSettingType.birdSpeedDownDamping:\n                value = (0.8*progress).toFixed(2);\n                break;\n            case EnumSettingType.birdJumpStrength:\n                value = (1600*progress).toFixed(0);\n                break;\n            case EnumSettingType.brickSpawnTime:\n                value = (400*progress).toFixed(0);\n                break;\n            case EnumSettingType.brickSpawnRand:\n                value = (1000*progress).toFixed(0);\n                break;\n            case EnumSettingType.brickSpeed:\n                value = (5+10*progress).toFixed(0);\n                break;\n            case EnumSettingType.brickHeight:\n                value = (50+400*progress).toFixed(0);\n                break;\n            case EnumSettingType.brickWidth:\n                value = (1+8*progress).toFixed(1);\n                break;\n            case EnumSettingType.brickPoint:\n                value = (1+2*progress).toFixed(0);\n                break;\n        }\n        this.localSetting[this.stringOfSetting[CustomEventData]] = value;//修改本地设置\n        this.sliderData[this.stringOfSetting[CustomEventData]] = progress;//修改本地滑动器设置\n        this.nodeArray[CustomEventData][EnumNodeType.lb_value].getComponent(Label).string = `${value}`//修改数字标签内容\n    }\n}\n\n"]}